window.__require=function t(e,o,i){function r(s,c){if(!o[s]){if(!e[s]){var l=s.split("/");if(l=l[l.length-1],!e[l]){var a="function"==typeof __require&&__require;if(!c&&a)return a(l,!0);if(n)return n(l,!0);throw new Error("Cannot find module '"+s+"'")}s=l}var u=o[s]={exports:{}};e[s][0].call(u.exports,function(t){return r(e[s][1][t]||t)},u,u.exports,t,e,o,i)}return o[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<i.length;s++)r(i[s]);return r}({BaseTile:[function(t,e,o){"use strict";cc._RF.push(e,"f9e57hdlKdG4o4Cxprt0UUm","BaseTile"),Object.defineProperty(o,"__esModule",{value:!0}),o.BaseTile=void 0;o.BaseTile=function(t){this.id=t},cc._RF.pop()},{}],BoardAction:[function(t,e,o){"use strict";cc._RF.push(e,"62be2jFtFxMJaXc0IIv9Dc0","BoardAction");var i=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(r,n){function s(t){try{l(i.next(t))}catch(e){n(e)}}function c(t){try{l(i.throw(t))}catch(e){n(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}l((i=i.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var o,i,r,n,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function c(t){return function(e){return l([t,e])}}function l(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){s.label=n[1];break}if(6===n[0]&&s.label<r[1]){s.label=r[1],r=n;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(n);break}r[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(c){n=[6,c],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.BoardAction=void 0;var n=t("../models/NormalTile"),s=function(){function t(t,e,o,i,r,n,s,c,l){this.board=t,this.tiles=e,this.tileFactory=o,this.framesById=i,this.boardView=r,this.rules=n,this.ops=s,this.progress=c,this.scorePerTile=l}return t.prototype.handleBoardClick=function(t,e,o){return i(this,void 0,Promise,function(){var i,s,c,l;return r(this,function(r){switch(r.label){case 0:return(i=this.tiles[t.r][t.c])?(s=i.getAffected(this.tiles,t),c=i instanceof n.NormalTile,this.rules.canCollect(c,s.length)?this.progress.canSpendMove()?(this.progress.spendMove(),l=null,c?l=this.rules.pickSuperId(s.length):s=this.rules.expandSuperGroup(this.tiles,s,t),[4,this.resolveAfterDestroy(s,l?{pos:t,id:l}:null,e,o)]):[2,"no_moves"]:[2,"ignored"]):[2,"ignored"];case 1:return[2,r.sent()?"done":"stopped"]}})})},t.prototype.activateSuperAt=function(t,e,o,n){return i(this,void 0,Promise,function(){var i,s;return r(this,function(r){switch(r.label){case 0:return i=this.tileFactory.createTile(e),this.board.set(t,i),this.boardView.createTileInPlace(t,this.framesById.get(e)),s=i.getAffected(this.tiles,t),0===(s=this.rules.expandSuperGroup(this.tiles,s,t)).length?[2,"ignored"]:[4,this.resolveAfterDestroy(s,null,o,n)];case 1:return[2,r.sent()?"done":"stopped"]}})})},t.prototype.addScore=function(t){var e=t*this.scorePerTile;this.progress.addScore(e)},t.prototype.resolveAfterDestroy=function(t,e,o,n){return i(this,void 0,Promise,function(){var i,s,c=this;return r(this,function(r){switch(r.label){case 0:return[4,this.boardView.hideTilesAnimated(t)];case 1:return r.sent(),this.addScore(t.length),t.forEach(function(t){c.board.set(t,null)}),e&&(this.board.set(e.pos,this.tileFactory.createTile(e.id)),this.boardView.createTileInPlace(e.pos,this.framesById.get(e.id))),i=this.ops.moveDown(this.tiles.length,this.tiles[0].length),[4,this.boardView.moveTilesAnimated(i)];case 2:return r.sent(),(s=this.ops.fillEmpty(this.tiles.length,this.tiles[0].length)).forEach(function(t){c.boardView.createTile(t.pos,c.framesById.get(t.id))}),[4,this.boardView.renderTilesAnimated(s.map(function(t){return t.pos}))];case 3:return r.sent(),o()?[2,!1]:[4,n()];case 4:return[2,r.sent()]}})})},t}();o.BoardAction=s,cc._RF.pop()},{"../models/NormalTile":"NormalTile"}],BoardController:[function(t,e,o){"use strict";cc._RF.push(e,"92a4de2zfFKGbNWD/7auqg7","BoardController");var i=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(r,n){function s(t){try{l(i.next(t))}catch(e){n(e)}}function c(t){try{l(i.throw(t))}catch(e){n(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}l((i=i.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var o,i,r,n,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function c(t){return function(e){return l([t,e])}}function l(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){s.label=n[1];break}if(6===n[0]&&s.label<r[1]){s.label=r[1],r=n;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(n);break}r[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(c){n=[6,c],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.BoardController=void 0;var n=t("../core/models/BoardModel"),s=t("../core/logic/BoardOps"),c=t("../core/logic/BoardRules"),l=t("../core/logic/BoardAction"),a=function(){function t(t,e,o,i,r,n,s,c,l,a,u,h){this.rows=t,this.cols=e,this.spawnTiles=o,this.tileFactory=i,this.superTileRules=r,this.boardView=n,this.framesById=s,this.startMoves=c,this.targetScore=l,this.scorePerTile=a,this.reshuffles=u,this.isBusy=!1,this.isGameOver=!1,this.reshufflesLeft=3,this.progress=h}return t.prototype.start=function(){return i(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return this.isGameOver=!1,this.reshufflesLeft=this.reshuffles,this.progress.init(this.startMoves,this.targetScore),this.generate(),[4,this.tryShuffleToGetMove()];case 1:return t.sent()?(this.endGame(!1),[2]):(this.boardView.onCellClick=null,[2])}})})},t.prototype.isBusyOrOver=function(){return this.isBusy||this.isGameOver},t.prototype.handleBoardClick=function(t){return i(this,void 0,Promise,function(){var e=this;return r(this,function(o){switch(o.label){case 0:return this.isBusy||this.isGameOver?[2]:(this.isBusy=!0,[4,this.actions.handleBoardClick(t,function(){return e.checkEndConditions()},function(){return e.afterBoardAction()})]);case 1:return"no_moves"===o.sent()&&this.endGame(!1),this.isBusy=!1,[2]}})})},t.prototype.setSelection=function(t,e){this.boardView.setSelected(t,e)},t.prototype.stop=function(){},t.prototype.generate=function(){var t=this;this.board=new n.BoardModel(this.rows,this.cols),this.tiles=this.board.getGrid(),this.ops=new s.BoardOps(this.board,this.tiles,this.tileFactory,function(){return t.randomId()}),this.rules=new c.BoardRules(this.superTileRules,this.cols),this.actions=new l.BoardAction(this.board,this.tiles,this.tileFactory,this.framesById,this.boardView,this.rules,this.ops,this.progress,this.scorePerTile),this.boardView.init(this.rows,this.cols),this.ops.generate(this.rows,this.cols).forEach(function(e){t.boardView.setFrameTile(e.pos,t.framesById.get(e.id))})},t.prototype.randomId=function(){var t=Math.floor(Math.random()*this.spawnTiles.length);return this.spawnTiles[t]},t.prototype.getTileId=function(t){var e,o=null===(e=this.tiles[t.r])||void 0===e?void 0:e[t.c];return o?o.id:null},t.prototype.swapTiles=function(t,e){var o,n;return i(this,void 0,Promise,function(){var i,s;return r(this,function(r){switch(r.label){case 0:return this.isBusy||this.isGameOver?[2]:(i=null===(o=this.tiles[t.r])||void 0===o?void 0:o[t.c],s=null===(n=this.tiles[e.r])||void 0===n?void 0:n[e.c],i&&s?(this.isBusy=!0,this.board.swap(t,e),[4,this.boardView.swapTilesAnimated(t,e)]):[2]);case 1:return r.sent(),[4,this.afterBoardAction()];case 2:return r.sent()?(this.isBusy=!1,[2]):[2]}})})},t.prototype.activateSuperAt=function(t,e){return i(this,void 0,Promise,function(){var o=this;return r(this,function(i){switch(i.label){case 0:return this.isBusy||this.isGameOver?[2]:(this.isBusy=!0,[4,this.actions.activateSuperAt(t,e,function(){return o.checkEndConditions()},function(){return o.afterBoardAction()})]);case 1:return"no_moves"===i.sent()&&this.endGame(!1),this.isBusy=!1,[2]}})})},t.prototype.checkEndConditions=function(){return this.progress.isWin()?(this.endGame(!0),!0):this.progress.getMoves()<=0&&(this.endGame(!1),!0)},t.prototype.afterBoardAction=function(){return i(this,void 0,Promise,function(){return r(this,function(t){switch(t.label){case 0:return this.checkEndConditions()?[2,!1]:[4,this.tryShuffleToGetMove()];case 1:return t.sent()?(this.endGame(!1),[2,!1]):[2,!0]}})})},t.prototype.tryShuffleToGetMove=function(){return i(this,void 0,Promise,function(){var t,e;return r(this,function(o){switch(o.label){case 0:if(this.rules.hasAnyMove(this.tiles,this.rows,this.cols))return[3,2];for(this.reshufflesLeft-=1,t=this.shuffleTilesAnimated(),e=1e3;!this.rules.hasAnyMove(this.tiles,this.rows,this.cols)&&e>0;)e--,t=this.shuffleTilesAnimated();return[4,this.boardView.animateViewsToPositions(t)];case 1:o.sent(),o.label=2;case 2:return[2,this.reshufflesLeft<0]}})})},t.prototype.shuffleTilesAnimated=function(){var t=this;return this.ops.shuffleTiles(this.rows,this.cols,function(e){return t.boardView.getTileView(e)},function(e,o){return t.boardView.setTileView(e,o)})},t.prototype.endGame=function(t){this.isGameOver=!0,this.boardView.onCellClick=null,this.progress.showResult(t?"\u041f\u043e\u0431\u0435\u0434\u0430":"\u041f\u043e\u0440\u0430\u0436\u0435\u043d\u0438\u0435")},t}();o.BoardController=a,cc._RF.pop()},{"../core/logic/BoardAction":"BoardAction","../core/logic/BoardOps":"BoardOps","../core/logic/BoardRules":"BoardRules","../core/models/BoardModel":"BoardModel"}],BoardModel:[function(t,e,o){"use strict";cc._RF.push(e,"3d631suiPBM4p2OXMmq6UwZ","BoardModel"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardModel=void 0;var i=function(){function t(t,e){this.rows=t,this.cols=e,this.grid=new Array(t);for(var o=0;o<t;o++)this.grid[o]=new Array(e).fill(null)}return t.prototype.get=function(t){var e,o;return null!==(o=null===(e=this.grid[t.r])||void 0===e?void 0:e[t.c])&&void 0!==o?o:null},t.prototype.set=function(t,e){this.grid[t.r]&&(this.grid[t.r][t.c]=e)},t.prototype.swap=function(t,e){var o=this.get(t),i=this.get(e);this.set(t,i),this.set(e,o)},t.prototype.getGrid=function(){return this.grid},t}();o.BoardModel=i,cc._RF.pop()},{}],BoardOps:[function(t,e,o){"use strict";cc._RF.push(e,"a5a2fwtwZ5GAaPz0lWeCRry","BoardOps"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardOps=void 0;var i=function(){function t(t,e,o,i){this.board=t,this.tiles=e,this.tileFactory=o,this.randomId=i}return t.prototype.generate=function(t,e){for(var o=[],i=0;i<t;i++)for(var r=0;r<e;r++){var n=this.randomId();this.board.set({r:i,c:r},this.tileFactory.createTile(n)),o.push({pos:{r:i,c:r},id:n})}return o},t.prototype.moveDown=function(t,e){var o=[];if(this.tiles.length<2)return o;for(var i=0;i<e;i++)for(var r=0,n=0;n<t;n++){var s=this.tiles[n][i];s&&(n!==r&&(o.push({from:{r:n,c:i},to:{r:r,c:i}}),this.board.set({r:r,c:i},s),this.board.set({r:n,c:i},null)),r++)}return o},t.prototype.fillEmpty=function(t,e){for(var o=[],i=0;i<t;i++)for(var r=0;r<e;r++)if(!this.tiles[i][r]){var n=this.randomId();this.board.set({r:i,c:r},this.tileFactory.createTile(n)),o.push({pos:{r:i,c:r},id:n})}return o},t.prototype.shuffleIndices=function(t){for(var e=Array.from({length:t},function(t,e){return e}),o=e.length-1;o>0;o--){var i=Math.floor(Math.random()*(o+1)),r=e[o];e[o]=e[i],e[i]=r}return e},t.prototype.shuffleTiles=function(t,e,o,i){for(var r=[],n=[],s=[],c=0;c<t;c++)for(var l=0;l<e;l++)r.push({r:c,c:l}),n.push(this.tiles[c][l]),s.push(o({r:c,c:l}));for(var a=this.shuffleIndices(r.length),u=[],h=0;h<r.length;h++){var p=a[h],f=r[h],d=n[p],y=s[p];this.board.set(f,d),y&&(i(f,y),u.push({view:y,to:f}))}return u},t}();o.BoardOps=i,cc._RF.pop()},{}],BoardRules:[function(t,e,o){"use strict";cc._RF.push(e,"dcfc9g/cUxF1KHJ2bLHkg2n","BoardRules"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoardRules=void 0;var i=t("../models/CellPos"),r=t("../models/NormalTile"),n=function(){function t(t,e){this.superTileRules=t,this.cols=e}return t.prototype.canCollect=function(t,e){return!t||e>=this.superTileRules.minGroupToDestroy},t.prototype.pickSuperId=function(t){return this.superTileRules.pickSpawnId(t)},t.prototype.expandSuperGroup=function(t,e,o){return this.uniqSuperTiles=new i.UniqueCellPosSet(this.cols),this.uniqTiles=new i.UniqueCellPosSet(this.cols),this.activateOtherSuperTiles(t,e,o),this.uniqTiles.toArray()},t.prototype.activateOtherSuperTiles=function(t,e,o){var i=this;this.uniqSuperTiles.add(o),e.forEach(function(e){i.uniqTiles.add(e);var o=t[e.r][e.c];o&&(o instanceof r.NormalTile||i.uniqSuperTiles.has(e)||i.activateOtherSuperTiles(t,o.getAffected(t,e),e))})},t.prototype.hasAnyMove=function(t,e,o){for(var i=0;i<e;i++)for(var r=0;r<o;r++){var n=t[i][r];if(n&&n.getAffected(t,{r:i,c:r}).length>=this.superTileRules.minGroupToDestroy)return!0}return!1},t}();o.BoardRules=n,cc._RF.pop()},{"../models/CellPos":"CellPos","../models/NormalTile":"NormalTile"}],BoardView:[function(t,e,o){"use strict";cc._RF.push(e,"f0603xaNXxC7qqmeLvETVH6","BoardView");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.BoardView=void 0;var s=t("./TileView"),c=t("./GridLayout"),l=cc._decorator,a=l.ccclass,u=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onCellClick=null,e.spawnFallDuration=.25,e.spawnFadeDuration=.25,e.moveDuration=.2,e.tilesRoot=null,e.tilesViewRoot=null,e.tilePrefab=null,e.cellPrefab=null,e.syncScheduled=!1,e.tileWidth=95,e.tileHeight=112,e.spacingX=0,e.spacingY=0,e.gridLayout=null,e.tileConfig=null,e}return r(e,t),e.prototype.applyGridConfig=function(t){t&&("number"==typeof t.tileWidth&&(this.tileWidth=t.tileWidth),"number"==typeof t.tileHeight&&(this.tileHeight=t.tileHeight),"number"==typeof t.spacingX&&(this.spacingX=t.spacingX),"number"==typeof t.spacingY&&(this.spacingY=t.spacingY))},e.prototype.applyConfig=function(t){t&&("number"==typeof t.spawnFallDuration&&(this.spawnFallDuration=t.spawnFallDuration),"number"==typeof t.spawnFadeDuration&&(this.spawnFadeDuration=t.spawnFadeDuration),"number"==typeof t.moveDuration&&(this.moveDuration=t.moveDuration))},e.prototype.applyTileConfig=function(t){if(t&&(this.tileConfig=t,this.tileViews))for(var e=0;e<this.tileViews.length;e++)for(var o=0;o<this.tileViews[e].length;o++){var i=this.tileViews[e][o];i&&i.view.applyConfig(this.tileConfig)}},e.prototype.init=function(t,e){var o=this.tilesRoot.getComponent(cc.Layout);o&&(o.enabled=!1),this.gridLayout=new c.GridLayout(t,e,this.tileWidth,this.tileHeight,this.spacingX,this.spacingY),this.tileViews=new Array(t);for(var i=0;i<this.tileViews.length;i++)this.tileViews[i]=new Array(e);this.tilesRoot.removeAllChildren(),this.tilesViewRoot&&this.tilesViewRoot.removeAllChildren(),this.syncScheduled=!1;for(var r=0;r<t;r++)for(var n=0;n<e;n++){var l=cc.instantiate(this.cellPrefab);l.parent=this.tilesRoot;var a=cc.instantiate(this.tilePrefab);a.parent=this.tilesViewRoot?this.tilesViewRoot:this.node,this.gridLayout&&this.gridLayout.applyToCellNode(l,r,n),a.width=this.tileWidth,a.height=this.tileHeight;var u=a.getComponent(s.TileView);this.tileConfig&&u.applyConfig(this.tileConfig),this.bindClick(u,{r:r,c:n}),this.tileViews[r][n]={view:u,pos:l}}this.syncNow(),this.requestSyncPositions()},e.prototype.createTile=function(t,e){this.setFrameTile(t,e),this.renderTileAnimated(t)},e.prototype.createTileInPlace=function(t,e){this.setFrameTile(t,e),this.renderTileAnimatedInPlace(t)},e.prototype.setFrameTile=function(t,e){var o=this.tileViews[t.r][t.c];o&&(o.view.setFrame(e),o.view.node.active=!0,o.view.node.opacity=255,o.view.node.scale=1,this.setPosition(t))},e.prototype.renderTileAnimated=function(t){var e=this,o=this.tileViews[t.r][t.c];if(!o)return Promise.resolve();var i=this.getCellLocalPos(t),r=cc.v2(i.x,i.y+2*o.pos.height);return new Promise(function(t){var n=o.view.node;n.stopAllActions(),n.active=!0,n.opacity=0,n.setPosition(r);var s=cc.moveTo(e.spawnFallDuration,i),c=cc.fadeTo(e.spawnFadeDuration,255),l=cc.spawn(s,c),a=cc.sequence(l,cc.callFunc(function(){return t()}));n.runAction(a)})},e.prototype.renderTileAnimatedInPlace=function(t){var e=this.tileViews[t.r][t.c];if(!e)return Promise.resolve();var o=e.view.node;return o.stopAllActions(),o.active=!0,o.opacity=255,this.setPosition(t),new Promise(function(t){e.view.playSpawn(t)})},e.prototype.renderTilesAnimated=function(t){var e=this;return Promise.all(t.map(function(t){return e.renderTileAnimated(t)})).then(function(){})},e.prototype.hideTileAnimated=function(t){var e=this.tileViews[t.r][t.c];return e?new Promise(function(t){e.view.playHide(t)}):Promise.resolve()},e.prototype.hideTilesAnimated=function(t){var e=this;return Promise.all(t.map(function(t){return e.hideTileAnimated(t)})).then(function(){})},e.prototype.setSelected=function(t,e){var o=this.tileViews[t.r][t.c];o&&(o.view.node.scale=e?1.15:1)},e.prototype.getTileView=function(t){var e=this.tileViews[t.r][t.c];return e?e.view:null},e.prototype.setTileView=function(t,e){var o=this.tileViews[t.r][t.c];o&&(o.view=e,this.bindClick(e,t))},e.prototype.animateViewsToPositions=function(t,e){var o=this;return void 0===e&&(e=this.moveDuration),0===t.length?Promise.resolve():Promise.all(t.map(function(t){var i=t.view.node,r=o.getCellLocalPos(t.to);return new Promise(function(t){i.stopAllActions(),i.active=!0,i.opacity=255,i.scale=1;var o=cc.moveTo(e,r),n=cc.sequence(o,cc.callFunc(function(){return t()}));i.runAction(n)})})).then(function(){o.refreshRenderOrder()})},e.prototype.moveTilesAnimated=function(t,e){var o=this;return void 0===e&&(e=this.moveDuration),0===t.length?Promise.resolve():Promise.all(t.map(function(t){return o.moveTileAnimated(t.from,t.to,e)})).then(function(){o.refreshRenderOrder()})},e.prototype.swapTilesAnimated=function(t,e,o){var i=this;void 0===o&&(o=this.moveDuration);var r=this.tileViews[t.r][t.c],n=this.tileViews[e.r][e.c];if(!r||!n)return Promise.resolve();var s=r.view,c=n.view;r.view=c,n.view=s,this.bindClick(r.view,t),this.bindClick(n.view,e);var l=this.getCellLocalPos(t),a=this.getCellLocalPos(e);return new Promise(function(t){var e=r.view.node,i=n.view.node;e.stopAllActions(),i.stopAllActions(),e.active=!0,i.active=!0;var s=cc.moveTo(o,l),c=cc.moveTo(o,a),u=cc.callFunc(function(){return t()});e.runAction(s),i.runAction(cc.sequence(c,u))}).then(function(){i.refreshRenderOrder()})},e.prototype.setPosition=function(t){var e=this.tileViews[t.r][t.c];e&&e.view.node.setPosition(this.getCellLocalPos(t))},e.prototype.getCellLocalPos=function(t){return this.gridLayout?this.gridLayout.getCellLocalPositionByPos(t):cc.v2(0,0)},e.prototype.moveTileAnimated=function(t,e,o){var i=this.tileViews[t.r][t.c],r=this.tileViews[e.r][e.c];if(!i||!r)return Promise.resolve();var n=i.view;i.view=r.view,r.view=n,this.bindClick(r.view,e),this.bindClick(i.view,t);var s=r.view.node,c=this.getCellLocalPos(e);return this.setPosition(t),i.view.node.active=!1,new Promise(function(t){s.stopAllActions(),s.active=!0,s.opacity=255,s.scale=1;var e=cc.moveTo(o,c),i=cc.sequence(e,cc.callFunc(function(){return t()}));s.runAction(i)})},e.prototype.requestSyncPositions=function(){var t=this;this.syncScheduled||(this.syncScheduled=!0,this.scheduleOnce(function(){t.syncScheduled=!1,t.syncNow()},0))},e.prototype.syncNow=function(){this.syncAllPositions(),this.refreshRenderOrder()},e.prototype.syncAllPositions=function(){for(var t=0;t<this.tileViews.length;t++)for(var e=0;e<this.tileViews[t].length;e++)this.tileViews[t][e]&&this.setPosition({r:t,c:e})},e.prototype.refreshRenderOrder=function(){var t,e,o=this.tileViews.length;if(o)for(var i=null!==(e=null===(t=this.tileViews[0])||void 0===t?void 0:t.length)&&void 0!==e?e:1,r=0;r<o;r++)for(var n=this.tileViews[r],s=0;s<n.length;s++){var c=n[s];if(c){var l=r*i+s;c.view.node.setSiblingIndex(l)}}},e.prototype.bindClick=function(t,e){var o=this;t.onClick=function(){var t;null===(t=o.onCellClick)||void 0===t||t.call(o,{r:e.r,c:e.c})}},n([u(cc.Node)],e.prototype,"tilesRoot",void 0),n([u(cc.Node)],e.prototype,"tilesViewRoot",void 0),n([u(cc.Prefab)],e.prototype,"tilePrefab",void 0),n([u(cc.Prefab)],e.prototype,"cellPrefab",void 0),n([a],e)}(cc.Component);o.BoardView=h,cc._RF.pop()},{"./GridLayout":"GridLayout","./TileView":"TileView"}],BombTile:[function(t,e,o){"use strict";cc._RF.push(e,"0f906hfZRVJHbFP0Os4nFM9","BombTile");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.BombTile=void 0;var n=t("../../../utils/Utils"),s=function(t){function e(e,o){var i=t.call(this,e)||this;return i.radius=o,i}return r(e,t),e.prototype.getAffected=function(t,e){for(var o=t.length,i=o>0?t[0].length:0,r=n.clamp(e.r-this.radius,0,o-1),s=n.clamp(e.r+this.radius,0,o-1),c=n.clamp(e.c-this.radius,0,i-1),l=n.clamp(e.c+this.radius,0,i-1),a=[],u=r;u<=s;u++)for(var h=c;h<=l;h++)t[u][h]&&a.push({r:u,c:h});return a},e}(t("./BaseTile").BaseTile);o.BombTile=s,cc._RF.pop()},{"../../../utils/Utils":"Utils","./BaseTile":"BaseTile"}],BoosterConfig:[function(t,e,o){"use strict";cc._RF.push(e,"7de38YFOQxLK6Ylf1S9sUyx","BoosterConfig"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],BoosterController:[function(t,e,o){"use strict";cc._RF.push(e,"1a909axuBtI2Zqq4rr3KGtg","BoosterController");var i=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(r,n){function s(t){try{l(i.next(t))}catch(e){n(e)}}function c(t){try{l(i.throw(t))}catch(e){n(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}l((i=i.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var o,i,r,n,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function c(t){return function(e){return l([t,e])}}function l(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){s.label=n[1];break}if(6===n[0]&&s.label<r[1]){s.label=r[1],r=n;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(n);break}r[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(c){n=[6,c],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterController=void 0;var n=function(){function t(t,e){this.board=t,this.first=null,this.id=e}return t.prototype.onCellClick=function(t){return i(this,void 0,Promise,function(){var e,o,i;return r(this,function(r){switch(r.label){case 0:return this.first?(e=this.first,this.first=null,e.r===t.r&&e.c===t.c?(this.board.setSelection(e,!1),[2,!1]):(o=this.board.getTileId(e),i=this.board.getTileId(t),null===o||null===i?(this.board.setSelection(e,!1),[2,!1]):o===i?(this.board.setSelection(e,!1),[2,!1]):(this.board.setSelection(e,!1),[4,this.board.swapTiles(e,t)]))):(this.first={r:t.r,c:t.c},this.board.setSelection(this.first,!0),[2,!1]);case 1:return r.sent(),[2,!0]}})})},t.prototype.reset=function(){this.first&&this.board.setSelection(this.first,!1),this.first=null},t}(),s=function(){function t(t,e,o){this.board=t,this.superTileId=o,this.id=e}return t.prototype.onCellClick=function(t){return i(this,void 0,Promise,function(){return r(this,function(e){switch(e.label){case 0:return[4,this.board.activateSuperAt(t,this.superTileId)];case 1:return e.sent(),[2,!0]}})})},t.prototype.reset=function(){},t}(),c=function(){function t(t,e,o){var i;this.board=t,this.view=e,this.activeId=null,this.charges=new Map,this.config=o,this.boosters=new Map;for(var r=0,n=this.config.boosters;r<n.length;r++){var s=n[r],c=this.createBooster(s);c&&this.boosters.set(s.id,c)}null===(i=this.view)||void 0===i||i.setActive(null)}return t.prototype.initCharges=function(){for(var t,e={},o=0,i=this.config.boosters;o<i.length;o++){var r=i[o];this.charges.set(r.id,r.charges),e[r.id]=r.charges}null===(t=this.view)||void 0===t||t.setCharges(e)},t.prototype.buildChargesMap=function(){var t={};return this.charges.forEach(function(e,o){t[o]=e}),t},t.prototype.setActive=function(t){var e;this.activeId=t,null===t&&this.boosters.forEach(function(t){return t.reset()}),null===(e=this.view)||void 0===e||e.setActive(t)},t.prototype.toggle=function(t){this.activeId===t?this.setActive(null):this.setActive(t)},t.prototype.handleCellClick=function(t){var e,o;return i(this,void 0,Promise,function(){var i,n,s,c;return r(this,function(r){switch(r.label){case 0:return this.board.isBusyOrOver()?[2]:this.activeId?[3,2]:[4,this.board.handleBoardClick(t)];case 1:return r.sent(),[2];case 2:if((i=null!==(e=this.charges.get(this.activeId))&&void 0!==e?e:0)<=0)return this.setActive(null),[2];if(!(n=this.boosters.get(this.activeId)))return[2];s=!1,r.label=3;case 3:return r.trys.push([3,5,,6]),[4,n.onCellClick(t)];case 4:return s=r.sent(),[3,6];case 5:return c=r.sent(),cc.error("Booster error",c),s=!1,[3,6];case 6:return s&&(this.charges.set(this.activeId,i-1),null===(o=this.view)||void 0===o||o.setCharges(this.buildChargesMap()),this.setActive(null)),[2]}})})},t.prototype.createBooster=function(t){switch(t.kind){case"swap":return new n(this.board,t.id);case"super":return new s(this.board,t.id,t.superTileId);default:return null}},t}();o.BoosterController=c,cc._RF.pop()},{}],BoosterView:[function(t,e,o){"use strict";cc._RF.push(e,"f7a3a7ZOU1GIKNsBGHgViOz","BoosterView");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterView=void 0;var s=cc._decorator,c=s.ccclass,l=s.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boosterButtons=[],e.boosterCounts=[],e.boosterIds=[],e.onToggle=null,e}return r(e,t),e.prototype.onEnable=function(){for(var t=0;t<this.boosterButtons.length;t++){var e=this.boosterButtons[t];e&&e.on(cc.Node.EventType.TOUCH_END,this.handleClick,this)}},e.prototype.onDisable=function(){for(var t=0;t<this.boosterButtons.length;t++){var e=this.boosterButtons[t];e&&e.off(cc.Node.EventType.TOUCH_END,this.handleClick,this)}},e.prototype.handleClick=function(t){var e=t.target,o=this.boosterButtons.indexOf(e);o<0||this.toggleByIndex(o)},e.prototype.toggleByIndex=function(t){var e,o=this.boosterIds[t];o&&(null===(e=this.onToggle)||void 0===e||e.call(this,o))},e.prototype.setCharges=function(t){for(var e=0;e<this.boosterIds.length;e++){var o=this.boosterIds[e],i=this.boosterCounts[e];if(i){var r=t[o];"number"==typeof r&&(i.string=""+r)}}},e.prototype.setActive=function(t){for(var e=0;e<this.boosterIds.length;e++){var o=this.boosterButtons[e];o&&(o.opacity=this.boosterIds[e]===t?255:160)}},n([l([cc.Node])],e.prototype,"boosterButtons",void 0),n([l([cc.Label])],e.prototype,"boosterCounts",void 0),n([l([cc.String])],e.prototype,"boosterIds",void 0),n([c],e)}(cc.Component);o.BoosterView=a,cc._RF.pop()},{}],CellPos:[function(t,e,o){"use strict";cc._RF.push(e,"3f0b3sWuplBUo0kwkmXDmq4","CellPos"),Object.defineProperty(o,"__esModule",{value:!0}),o.UniqueCellPosSet=void 0;var i=function(){function t(t){this.cols=t,this.map=new Map}return t.prototype.key=function(t){return t.r*this.cols+t.c},t.prototype.add=function(t){this.map.set(this.key(t),{r:t.r,c:t.c})},t.prototype.has=function(t){return this.map.has(this.key(t))},t.prototype.delete=function(t){return this.map.delete(this.key(t))},t.prototype.clear=function(){this.map.clear()},Object.defineProperty(t.prototype,"size",{get:function(){return this.map.size},enumerable:!1,configurable:!0}),t.prototype.toArray=function(){return Array.from(this.map.values())},t.prototype.values=function(){return this.map.values()},t}();o.UniqueCellPosSet=i,cc._RF.pop()},{}],FitGameWindow:[function(t,e,o){"use strict";cc._RF.push(e,"97e294ZO3FJpa5AoDKhp9Fd","FitGameWindow");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,l=s.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.designWidth=1080,e.designHeight=1920,e}return r(e,t),e.prototype.onEnable=function(){this.applyScale(),cc.view.on("canvas-resize",this.applyScale,this)},e.prototype.onDisable=function(){cc.view.off("canvas-resize",this.applyScale,this)},e.prototype.applyScale=function(){var t=cc.view.getVisibleSize(),e=Math.min(t.width/this.designWidth,t.height/this.designHeight);this.node.scale=e},n([l],e.prototype,"designWidth",void 0),n([l],e.prototype,"designHeight",void 0),n([c],e)}(cc.Component);o.default=a,cc._RF.pop()},{}],GameInstaller:[function(t,e,o){"use strict";cc._RF.push(e,"d7f85mVDtBM/pmqe3HrwQHA","GameInstaller");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(r,n){function s(t){try{l(i.next(t))}catch(e){n(e)}}function c(t){try{l(i.throw(t))}catch(e){n(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}l((i=i.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var o,i,r,n,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function c(t){return function(e){return l([t,e])}}function l(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){s.label=n[1];break}if(6===n[0]&&s.label<r[1]){s.label=r[1],r=n;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(n);break}r[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(c){n=[6,c],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.GameInstaller=void 0;var l=t("../configs/JsonLoader"),a=t("../configs/TileRegistry"),u=t("./BoardController"),h=t("../core/logic/SuperTileRules"),p=t("../core/logic/TileFactory"),f=t("../ui/BoardView"),d=t("../ui/HudView"),y=t("./ProgressController"),v=t("./BoosterController"),w=t("../ui/BoosterView"),g=cc._decorator,b=g.ccclass,m=g.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boardView=null,e.hudView=null,e.boosterView=null,e.startMoves=30,e.targetScore=500,e.rows=8,e.cols=8,e.catalogPath="configs/tile_catalog",e.superRulesPath="configs/super_rules",e.boostersPath="configs/boosters",e.uiConfigPath="configs/ui",e.gameplayConfigPath="configs/gameplay",e}return r(e,t),e.prototype.start=function(){var t,e,o;return s(this,void 0,Promise,function(){var i,r,n,s,f,d,w,g,b,m,_,T,P,C,R,B,O,F;return c(this,function(c){switch(c.label){case 0:return[4,l.JsonLoader.load(this.catalogPath)];case 1:return i=c.sent(),r=new a.TileRegistry(i.tiles),[4,l.JsonLoader.load(this.superRulesPath)];case 2:return n=c.sent(),[4,l.JsonLoader.load(this.uiConfigPath)];case 3:return s=c.sent(),[4,l.JsonLoader.load(this.gameplayConfigPath)];case 4:f=c.sent(),this.validateGameplayConfig(f),this.startMoves=f.startMoves,this.targetScore=f.targetScore,this.rows=f.rows,this.cols=f.cols,d=r.getSpawnTiles(),this.validateSpawnTiles(d),this.validateSuperRules(n),w=new h.SuperTileRules(n),g=new Map,b=0,m=r.getAllTile(),c.label=5;case 5:return b<m.length?(_=m[b],T=r.getTileConfigById(_),[4,this.loadSpriteFrame(T.sprite)]):[3,8];case 6:P=c.sent(),g.set(_,P),c.label=7;case 7:return b++,[3,5];case 8:return[4,l.JsonLoader.load(this.boostersPath)];case 9:return C=c.sent(),R=new p.TileFactory(r),B=new y.ProgressController(null!==(t=this.hudView)&&void 0!==t?t:void 0),this.hudView&&(this.hudView.onRestart=function(){var t=cc.director.getScene();t&&cc.director.loadScene(t.name)}),this.boardView&&(this.boardView.applyGridConfig({tileWidth:f.tileWidth,tileHeight:f.tileHeight,spacingX:f.spacingX,spacingY:f.spacingY}),this.boardView.applyConfig(null==s?void 0:s.board),this.boardView.applyTileConfig(null==s?void 0:s.tile)),this.hudView&&this.hudView.applyConfig(null==s?void 0:s.hud),[4,(O=new u.BoardController(this.rows,this.cols,d,R,w,this.boardView,g,this.startMoves,this.targetScore,f.scorePerTile,f.reshuffles,B)).start()];case 10:return c.sent(),(F=new v.BoosterController(O,null!==(e=this.boosterView)&&void 0!==e?e:void 0,C)).initCharges(),this.boosterView&&(this.boosterView.onToggle=function(t){return F.toggle(t)}),this.boardView.onCellClick=function(t){F.handleCellClick(t)},null===(o=this.hudView)||void 0===o||o.playStartFade(),[2]}})})},e.prototype.validateGameplayConfig=function(t){if(t.rows<=0||t.cols<=0)throw new Error("GameplayConfig: rows/cols must be > 0");if(t.tileWidth<=0||t.tileHeight<=0)throw new Error("GameplayConfig: tileWidth/tileHeight must be > 0");if(t.scorePerTile<=0)throw new Error("GameplayConfig: scorePerTile must be > 0")},e.prototype.validateSpawnTiles=function(t){if(!t||0===t.length)throw new Error("TileCatalog: no normal tiles to spawn")},e.prototype.validateSuperRules=function(t){if(t.minGroupToDestroy<2)throw new Error("SuperRules: minGroupToDestroy must be >= 2");if(!t.rules||0===t.rules.length)throw new Error("SuperRules: rules must not be empty")},e.prototype.loadSpriteFrame=function(t){return new Promise(function(e,o){cc.resources.load(t,cc.SpriteFrame,function(t,i){if(t)return o(t);e(i)})})},n([m(f.BoardView)],e.prototype,"boardView",void 0),n([m(d.HudView)],e.prototype,"hudView",void 0),n([m(w.BoosterView)],e.prototype,"boosterView",void 0),n([m],e.prototype,"catalogPath",void 0),n([m],e.prototype,"superRulesPath",void 0),n([m],e.prototype,"boostersPath",void 0),n([m],e.prototype,"uiConfigPath",void 0),n([m],e.prototype,"gameplayConfigPath",void 0),n([b],e)}(cc.Component);o.GameInstaller=_,cc._RF.pop()},{"../configs/JsonLoader":"JsonLoader","../configs/TileRegistry":"TileRegistry","../core/logic/SuperTileRules":"SuperTileRules","../core/logic/TileFactory":"TileFactory","../ui/BoardView":"BoardView","../ui/BoosterView":"BoosterView","../ui/HudView":"HudView","./BoardController":"BoardController","./BoosterController":"BoosterController","./ProgressController":"ProgressController"}],GameplayConfig:[function(t,e,o){"use strict";cc._RF.push(e,"8e39bx2yWRHiqjevoNKPrXv","GameplayConfig"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],GridLayout:[function(t,e,o){"use strict";cc._RF.push(e,"1b132jr8gpCPp01RDQz9Vpq","GridLayout"),Object.defineProperty(o,"__esModule",{value:!0}),o.GridLayout=void 0;var i=function(){function t(t,e,o,i,r,n){this.rows=t,this.cols=e,this.tileWidth=o,this.tileHeight=i,this.spacingX=r,this.spacingY=n}return t.prototype.getCellLocalPosition=function(t,e){var o=this.cols*this.tileWidth+(this.cols-1)*this.spacingX,i=this.rows*this.tileHeight+(this.rows-1)*this.spacingY,r=-o/2+this.tileWidth/2,n=-i/2+this.tileHeight/2,s=r+e*(this.tileWidth+this.spacingX),c=n+t*(this.tileHeight+this.spacingY);return cc.v2(s,c)},t.prototype.applyToCellNode=function(t,e,o){t.width=this.tileWidth,t.height=this.tileHeight,t.setPosition(this.getCellLocalPosition(e,o))},t.prototype.getCellLocalPositionByPos=function(t){return this.getCellLocalPosition(t.r,t.c)},t}();o.GridLayout=i,cc._RF.pop()},{}],HudView:[function(t,e,o){"use strict";cc._RF.push(e,"a633fk8awdJS7nIB7GcH6lD","HudView");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.HudView=void 0;var s=cc._decorator,c=s.ccclass,l=s.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scoreLabel=null,e.movesLabel=null,e.resultLabel=null,e.resultOverlay=null,e.restartButton=null,e.startFadeOverlay=null,e.fadeDuration=.4,e.fadeDelay=.05,e.onRestart=null,e}return r(e,t),e.prototype.applyConfig=function(t){t&&("number"==typeof t.fadeDuration&&(this.fadeDuration=t.fadeDuration),"number"==typeof t.fadeDelay&&(this.fadeDelay=t.fadeDelay))},e.prototype.onEnable=function(){this.restartButton&&this.restartButton.node.on(cc.Node.EventType.TOUCH_END,this.restart,this)},e.prototype.onDisable=function(){this.restartButton&&this.restartButton.node.off(cc.Node.EventType.TOUCH_END,this.restart,this)},e.prototype.setScore=function(t,e){this.scoreLabel&&(this.scoreLabel.string=t+"/"+e)},e.prototype.setMoves=function(t){this.movesLabel&&(this.movesLabel.string=""+t)},e.prototype.showResult=function(t){this.resultLabel&&(this.resultLabel.string=t),this.resultLabel&&(this.resultLabel.node.active=!0),this.resultOverlay&&(this.resultOverlay.active=!0)},e.prototype.hideResult=function(){this.resultLabel&&(this.resultLabel.node.active=!1),this.resultOverlay&&(this.resultOverlay.active=!1)},e.prototype.playStartFade=function(){if(this.startFadeOverlay){var t=this.startFadeOverlay;t.stopAllActions(),t.active=!0,t.opacity=255,cc.tween(t).delay(this.fadeDelay).to(this.fadeDuration,{opacity:0}).call(function(){t.active=!1}).start()}},e.prototype.restart=function(){var t;null===(t=this.onRestart)||void 0===t||t.call(this)},n([l(cc.Label)],e.prototype,"scoreLabel",void 0),n([l(cc.Label)],e.prototype,"movesLabel",void 0),n([l(cc.Label)],e.prototype,"resultLabel",void 0),n([l(cc.Node)],e.prototype,"resultOverlay",void 0),n([l(cc.Button)],e.prototype,"restartButton",void 0),n([l(cc.Node)],e.prototype,"startFadeOverlay",void 0),n([c],e)}(cc.Component);o.HudView=a,cc._RF.pop()},{}],JsonLoader:[function(t,e,o){"use strict";cc._RF.push(e,"04186/pxeZP3oOkCJF9n/yl","JsonLoader"),Object.defineProperty(o,"__esModule",{value:!0}),o.JsonLoader=void 0;var i=function(){function t(){}return t.load=function(t){return new Promise(function(e,o){cc.resources.load(t,cc.JsonAsset,function(t,i){if(t)return o(t);e(i.json)})})},t}();o.JsonLoader=i,cc._RF.pop()},{}],NormalTile:[function(t,e,o){"use strict";cc._RF.push(e,"099f3WTbOBBIpKwa+7inbSn","NormalTile");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.NormalTile=void 0;var n=t("./BaseTile"),s=t("./CellPos"),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.getAffected=function(t,e){return this.uniqCell=new s.UniqueCellPosSet(t[0].length),this.getNeighbours(t,e)},e.prototype.getNeighbours=function(t,e){var o=[],i=t[e.r][e.c];return i?(this.uniqCell.add(e),o.push(e),e.r-1>=0&&!this.uniqCell.has({r:e.r-1,c:e.c})&&t[e.r-1][e.c]&&i.id===t[e.r-1][e.c].id&&o.push.apply(o,this.getNeighbours(t,{r:e.r-1,c:e.c})),e.r+1<t.length&&!this.uniqCell.has({r:e.r+1,c:e.c})&&t[e.r+1][e.c]&&i.id===t[e.r+1][e.c].id&&o.push.apply(o,this.getNeighbours(t,{r:e.r+1,c:e.c})),e.c-1>=0&&!this.uniqCell.has({r:e.r,c:e.c-1})&&t[e.r][e.c-1]&&i.id===t[e.r][e.c-1].id&&o.push.apply(o,this.getNeighbours(t,{r:e.r,c:e.c-1})),e.c+1<t[e.r].length&&!this.uniqCell.has({r:e.r,c:e.c+1})&&t[e.r][e.c+1]&&i.id===t[e.r][e.c+1].id&&o.push.apply(o,this.getNeighbours(t,{r:e.r,c:e.c+1})),o):o},e}(n.BaseTile);o.NormalTile=c,cc._RF.pop()},{"./BaseTile":"BaseTile","./CellPos":"CellPos"}],ProgressController:[function(t,e,o){"use strict";cc._RF.push(e,"381d6cQGnRMdqSDi2charyg","ProgressController"),Object.defineProperty(o,"__esModule",{value:!0}),o.ProgressController=void 0;var i=function(){function t(t){this.movesLeft=0,this.score=0,this.target=0,this.hud=null,this.hud=null!=t?t:null}return t.prototype.setHud=function(t){this.hud=null!=t?t:null},t.prototype.init=function(t,e){var o,i,r;this.movesLeft=Math.max(0,t),this.score=0,this.target=Math.max(0,e),null===(o=this.hud)||void 0===o||o.hideResult(),null===(i=this.hud)||void 0===i||i.setMoves(this.movesLeft),null===(r=this.hud)||void 0===r||r.setScore(this.score,this.target)},t.prototype.canSpendMove=function(){return this.movesLeft>0},t.prototype.spendMove=function(){var t;this.movesLeft<=0||(this.movesLeft-=1,null===(t=this.hud)||void 0===t||t.setMoves(this.movesLeft))},t.prototype.addScore=function(t){var e;t<=0||(this.score+=t,null===(e=this.hud)||void 0===e||e.setScore(this.score,this.target))},t.prototype.getMoves=function(){return this.movesLeft},t.prototype.isWin=function(){return this.score>=this.target},t.prototype.showResult=function(t){var e;null===(e=this.hud)||void 0===e||e.showResult(t)},t}();o.ProgressController=i,cc._RF.pop()},{}],RocketColTile:[function(t,e,o){"use strict";cc._RF.push(e,"d2a92nMw3NLmL0OBKVIBahl","RocketColTile");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.RocketColTile=void 0;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.getAffected=function(t,e){for(var o=e.c,i=[],r=0;r<t.length;r++)t[r][o]&&i.push({r:r,c:o});return i},e}(t("./BaseTile").BaseTile);o.RocketColTile=n,cc._RF.pop()},{"./BaseTile":"BaseTile"}],RocketRowTile:[function(t,e,o){"use strict";cc._RF.push(e,"cbcabJngPhK/63fscZ71/Hj","RocketRowTile");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.RocketRowTile=void 0;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.getAffected=function(t,e){for(var o=e.r,i=[],r=0;r<t[o].length;r++)t[o][r]&&i.push({r:o,c:r});return i},e}(t("./BaseTile").BaseTile);o.RocketRowTile=n,cc._RF.pop()},{"./BaseTile":"BaseTile"}],SuperTileRules:[function(t,e,o){"use strict";cc._RF.push(e,"c15e6woxyVPu6WOdAjQ8ZXl","SuperTileRules"),Object.defineProperty(o,"__esModule",{value:!0}),o.SuperTileRules=void 0;var i=function(){function t(t){this.minGroupToDestroy=t.minGroupToDestroy,this.rules=t.rules.slice().sort(function(t,e){return e.minGroup-t.minGroup})}return t.prototype.pickSpawnId=function(t){for(var e=0,o=this.rules;e<o.length;e++){var i=o[e];if(t>=i.minGroup){var r=i.spawnIds;return r[Math.floor(Math.random()*r.length)]}}return null},t}();o.SuperTileRules=i,cc._RF.pop()},{}],TileConfig:[function(t,e,o){"use strict";cc._RF.push(e,"3df7aDWY+FOqookT8NeJMW9","TileConfig"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TileFactory:[function(t,e,o){"use strict";cc._RF.push(e,"7ad44AD7qtBu6Jop7KqS4n5","TileFactory"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileFactory=void 0;var i=t("../models/BombTile"),r=t("../models/NormalTile"),n=t("../models/RocketColTile"),s=t("../models/RocketRowTile"),c=function(){function t(t){this.registry=t}return t.prototype.createTile=function(t){var e=this.registry.getTileConfigById(t);switch(e.kind){case"normal":return new r.NormalTile(e.id);case"bomb":return new i.BombTile(e.id,e.radius);case"rocketRow":return new s.RocketRowTile(e.id);case"rocketCol":return new n.RocketColTile(e.id);default:throw new Error("Unknown tile kind: "+e.kind)}},t}();o.TileFactory=c,cc._RF.pop()},{"../models/BombTile":"BombTile","../models/NormalTile":"NormalTile","../models/RocketColTile":"RocketColTile","../models/RocketRowTile":"RocketRowTile"}],TileRegistry:[function(t,e,o){"use strict";cc._RF.push(e,"4ede869jQNMFJ8QPkc0AViQ","TileRegistry"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileRegistry=void 0;var i=function(){function t(t){this.byId=new Map;for(var e=0,o=t;e<o.length;e++){var i=o[e];this.byId.set(i.id,i)}}return t.prototype.getTileConfigById=function(t){var e=this.byId.get(t);if(!e)throw new Error("No Tile for id="+t);return e},t.prototype.getSpawnTiles=function(){var t=[];if(this.byId.forEach(function(e){"normal"===e.kind&&t.push(e.id)}),0===t.length)throw new Error("No normal tiles to spawn (tile_catalog.json)");return t},t.prototype.getAllTile=function(){return Array.from(this.byId.keys())},t}();o.TileRegistry=i,cc._RF.pop()},{}],TileView:[function(t,e,o){"use strict";cc._RF.push(e,"f51c86x9MtJ/q/coPHdh7Ks","TileView");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.TileView=void 0;var s=cc._decorator,c=s.ccclass,l=s.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onClick=null,e.sprite=null,e.spawnScaleDuration=.5,e.spawnFadeDuration=.5,e.hideScaleDuration=.5,e.hideFadeDuration=.5,e}return r(e,t),e.prototype.applyConfig=function(t){t&&("number"==typeof t.spawnScaleDuration&&(this.spawnScaleDuration=t.spawnScaleDuration),"number"==typeof t.spawnFadeDuration&&(this.spawnFadeDuration=t.spawnFadeDuration),"number"==typeof t.hideScaleDuration&&(this.hideScaleDuration=t.hideScaleDuration),"number"==typeof t.hideFadeDuration&&(this.hideFadeDuration=t.hideFadeDuration))},e.prototype.setFrame=function(t){this.sprite.spriteFrame=t,this.node.active=!0},e.prototype.hide=function(){this.node.active=!1},e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.handleClick,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_END,this.handleClick,this)},e.prototype.handleClick=function(){var t;null===(t=this.onClick)||void 0===t||t.call(this)},e.prototype.playSpawn=function(t){var e=this;this.node.stopAllActions(),this.node.active=!0,this.node.scale=0;var o=cc.scaleTo(this.spawnScaleDuration,1).easing(cc.easeBackIn()),i=cc.fadeTo(this.spawnFadeDuration,255),r=cc.spawn(o,i),n=cc.sequence(r,cc.callFunc(function(){e.node.active=!0,e.node.opacity=255,null==t||t()}));this.node.runAction(n)},e.prototype.playHide=function(t){var e=this;this.node.stopAllActions();var o=cc.scaleTo(this.hideScaleDuration,.1).easing(cc.easeBackIn()),i=cc.fadeTo(this.hideFadeDuration,0),r=cc.spawn(o,i),n=cc.sequence(r,cc.callFunc(function(){e.node.active=!1,e.node.opacity=255,e.node.scale=1,null==t||t()}));this.node.runAction(n)},n([l(cc.Sprite)],e.prototype,"sprite",void 0),n([c],e)}(cc.Component);o.TileView=a,cc._RF.pop()},{}],UIConfig:[function(t,e,o){"use strict";cc._RF.push(e,"1941adv5vpLDb3+yqvZIvwz","UIConfig"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],Utils:[function(t,e,o){"use strict";cc._RF.push(e,"c6019UVaHBBrYjLqHJQIgz1","Utils"),Object.defineProperty(o,"__esModule",{value:!0}),o.clamp=o.delay=void 0,o.delay=function(t){return new Promise(function(e){return setTimeout(e,t)})},o.clamp=function(t,e,o){return Math.max(e,Math.min(o,t))},cc._RF.pop()},{}]},{},["BoardController","BoosterController","GameInstaller","ProgressController","BoosterConfig","GameplayConfig","JsonLoader","TileConfig","TileRegistry","UIConfig","BoardAction","BoardOps","BoardRules","SuperTileRules","TileFactory","BaseTile","BoardModel","BombTile","CellPos","NormalTile","RocketColTile","RocketRowTile","BoardView","BoosterView","FitGameWindow","GridLayout","HudView","TileView","Utils"]);